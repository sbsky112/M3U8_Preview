# 默认管理员账号说明

## 📋 概述

系统已配置默认管理员账号，无需手动创建。首次访问时会自动初始化。

## 🔐 默认管理员账号

**账号信息：**
- **用户名**: `admin`
- **密码**: `admin123`
- **角色**: 管理员（admin）
- **权限**: 系统最高权限

## 🚀 使用方法

### 1. 首次登录

1. 访问登录页面：http://localhost:3000/auth/signin
2. 输入账号：`admin`
3. 输入密码：`admin123`
4. 点击登录

### 2. 修改密码

⚠️ **强烈建议首次登录后立即修改密码！**

**修改步骤：**
1. 登录后，点击导航栏的"修改密码"
2. 输入当前密码：`admin123`
3. 输入新密码（至少6位）
4. 确认新密码
5. 点击"修改密码"

或直接访问：http://localhost:3000/profile/change-password

## 🛡️ 系统特性

### 唯一管理员

- ✅ 系统**有且只有一个**管理员账号
- ✅ 不能创建其他管理员
- ✅ 不能将普通用户升级为管理员
- ✅ 不能删除默认管理员账号
- ✅ 不能修改默认管理员的角色

### 自动初始化

系统会在以下情况自动创建默认管理员：
- 运行 `npm run db:push` 时
- 运行 `npm run db:seed` 时
- 如果管理员已存在，会跳过创建

### 密码安全

- ✅ 密码使用 bcrypt 加密存储
- ✅ 支持随时修改密码
- ✅ 修改密码需要验证当前密码
- ✅ 建议使用强密码（12位以上，包含大小写字母、数字、特殊字符）

## 📊 管理员权限

### 完整权限列表

**用户管理：**
- ✅ 查看所有用户
- ✅ 修改普通用户信息
- ✅ 删除普通用户
- ❌ 不能修改自己的角色
- ❌ 不能将其他用户设为管理员

**视频管理：**
- ✅ 查看所有视频
- ✅ 编辑任意视频
- ✅ 删除任意视频
- ✅ 上传视频
- ✅ 批量操作

**系统管理：**
- ✅ 访问管理后台
- ✅ 查看系统统计
- ✅ 修改自己的密码
- ✅ 所有普通用户权限

## 🔧 技术实现

### 初始化流程

```
应用启动
    ↓
中间件检查
    ↓
管理员存在？
    ↓
否 → 创建默认管理员
是 → 跳过
    ↓
继续处理请求
```

### 数据库结构

```prisma
model User {
  id        String   @id @default(cuid())
  email     String   @unique  // "admin"
  password  String             // bcrypt 加密
  name      String?            // "系统管理员"
  role      String             // "admin"
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
```

### 权限检查

```typescript
// 检查是否是默认管理员
import { isDefaultAdmin } from '@/lib/init-admin'

if (isDefaultAdmin(user.email)) {
  // 特殊处理
}
```

## ⚠️ 安全建议

### 1. 立即修改密码

默认密码 `admin123` 不安全，首次登录后**必须**修改！

**强密码示例：**
- `MySecure@Password2024!`
- `Admin#System$2024`
- `SuperS3cure!Pass`

### 2. 定期更换密码

建议每 3-6 个月更换一次管理员密码。

### 3. 不要共享账号

管理员账号拥有最高权限，不要分享给他人。

### 4. 监控异常操作

定期检查：
- 用户管理页面
- 视频管理情况
- 系统统计数据

### 5. 备份数据

定期备份数据库，防止数据丢失。

## 🆘 常见问题

### Q1: 忘记管理员密码怎么办？

**方案 1：数据库重置（推荐）**

使用 Prisma Studio：
```bash
npm run db:studio
```

1. 打开 http://localhost:5555
2. 选择 `User` 表
3. 找到 email 为 `admin` 的记录
4. 更新 password 字段为新的 bcrypt 哈希值

生成新密码哈希：
```javascript
const bcrypt = require('bcryptjs')
const newHash = bcrypt.hashSync('your-new-password', 10)
console.log(newHash)
```

**方案 2：删除并重建**

```sql
-- 删除管理员账号
DELETE FROM "User" WHERE email = 'admin';

-- 重启应用，系统会自动创建
```

### Q2: 可以创建多个管理员吗？

**不可以。** 系统设计为**有且只有一个管理员**。

原因：
- 简化权限管理
- 提高安全性
- 避免权限冲突

### Q3: 可以更改管理员用户名吗？

**不建议。** 默认管理员的用户名 `admin` 是硬编码的。

如果必须更改：
1. 修改 `lib/init-admin.ts` 中的 `DEFAULT_ADMIN.email`
2. 更新数据库中的记录
3. 重启应用

### Q4: 管理员账号被误删了怎么办？

**重新创建：**
```bash
# 运行数据库初始化
npm run db:seed
```

或使用 Prisma Studio：
```bash
npm run db:studio
# 手动创建管理员记录
```

### Q5: 登录页面不显示默认账号信息？

刷新页面或清除浏览器缓存。默认账号信息显示在登录页面的紫色提示框中。

## 📝 维护建议

### 日常维护

**每周：**
- [ ] 检查用户列表
- [ ] 查看新增视频
- [ ] 监控系统统计

**每月：**
- [ ] 审查权限分配
- [ ] 清理无效用户
- [ ] 备份数据库

**每季度：**
- [ ] 更换管理员密码
- [ ] 审计操作日志（未来功能）
- [ ] 优化系统性能

### 安全检查清单

- [ ] 管理员密码已修改（不是默认密码）
- [ ] 密码强度足够（12位以上）
- [ ] 不共享管理员账号
- [ ] 定期检查用户列表
- [ ] 定期备份数据库
- [ ] 监控异常登录
- [ ] 及时删除可疑账号

## 📚 相关文档

- [管理员功能指南](./ADMIN_GUIDE.md)
- [权限系统说明](../lib/permissions.ts)
- [用户管理](../app/admin/users/page.tsx)
- [密码修改](../app/profile/change-password/page.tsx)

## 🔮 未来功能

计划中的功能：

- [ ] 双因素认证（2FA）
- [ ] 登录日志记录
- [ ] 密码强度检测
- [ ] 自动密码过期
- [ ] 登录失败锁定
- [ ] 异常登录通知

## 🎯 最佳实践

1. **首次登录后立即修改密码**
2. **使用强密码（12位以上）**
3. **不要使用常见密码**
4. **定期更换密码（3-6个月）**
5. **不要共享管理员账号**
6. **定期备份数据库**
7. **监控系统活动**
8. **及时处理异常情况**

---

**重要提示：** 默认管理员账号是系统的核心，请妥善保管密码并定期维护！

**问题反馈**: 查看 [TROUBLESHOOTING.md](../TROUBLESHOOTING.md) 或提交 Issue。
